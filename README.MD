Relat√≥rio Final: Trabalho 4 - Implementando Defesas Arquiteturais

Disciplina: DCC 704 - Arquitetura e Tecnologias de Sistemas WEB
Professor: Jean Bertrand
Aluno:Helian vinicius Filinto da Silva
Matricula: 2022008985


üéØ Objetivo do Trabalho

Fortificar a arquitetura do projeto web (baseado nas Aulas 18 e 19) contra as vulnerabilidades mais cr√≠ticas da OWASP, aplicando middlewares de seguran√ßa e boas pr√°ticas na camada do servidor.

üõ°Ô∏è Vulnerabilidades Mitigadas e Mecanismos de Defesa

A tabela a seguir lista as vulnerabilidades cr√≠ticas tratadas e especifica os mecanismos de defesa implementados no projeto:

OWASP TOP 10

Vulnerabilidade

Mecanismo de Defesa Aplicado

Localiza√ß√£o da Defesa

A03

SQL Injection (SQLi)

Queries Parametrizadas

models/User.js e app.js (Via Mongoose)

A07

Cross-Site Scripting (XSS)

Output Escaping por Padr√£o

Todas as Views (.ejs)

A04

Cross-Site Request Forgery (CSRF)

Tokens Anti-CSRF

app.js (csurf middleware) e rotas POST

A04

Broken Access Control (BAC)

Middleware de Autoriza√ß√£o (AuthZ)

middleware/auth.js (isAuth) e rotas restritas (/perfil)

N/A

Ataques de For√ßa Bruta

Limita√ß√£o de Taxa (Rate Limiting)

app.js (express-rate-limit) na rota POST /login

N/A

Exposi√ß√£o de Credenciais

Vari√°veis de Ambiente

app.js (dotenv) e arquivo .env

N/A

Hardening de HTTP

HTTP Security Headers

app.js (helmet middleware)

‚öôÔ∏è Detalhamento das Implementa√ß√µes (Trabalho 4)

1. Defesas Contra SQLi e XSS (Revis√£o e Valida√ß√£o)

Defesa SQLi: O projeto utiliza Mongoose (um ODM para MongoDB), que previne ataques de SQLi ao construir todas as consultas com Queries Parametrizadas por padr√£o. N√£o h√° concatena√ß√£o manual de strings com comandos de banco de dados no c√≥digo.

Defesa XSS: Foi verificado que todas as Views (simuladas ou reais) renderizam dados de usu√°rio utilizando a sintaxe de Output Escaping do EJS (<%= variavel %>), que converte caracteres HTML especiais (<, >) em entidades seguras.

2. Defesa Contra For√ßa Bruta (Rate Limiting)

O middleware express-rate-limit foi configurado e aplicado √† rota de login para limitar o n√∫mero de tentativas de autentica√ß√£o:

Configura√ß√£o: Regra de 5 tentativas por minuto (max: 5, windowMs: 60 * 1000).

Implementa√ß√£o: Aplicado diretamente na rota sens√≠vel: app.post('/login', authRateLimiter, authController.login).

3. Hardening HTTP e Prote√ß√£o de Credenciais

Prote√ß√£o de Headers (Helmet): O app.js aplica o middleware helmet() logo no topo da cadeia de middlewares, garantindo a inclus√£o de cabe√ßalhos essenciais como X-Frame-Options e X-Content-Type-Options para mitigar ataques como Clickjacking e MIME type sniffing.

Prote√ß√£o de Credenciais (dotenv): A chave secreta da sess√£o (SESSION_SECRET) e a string de conex√£o do MongoDB Atlas (DB_CONNECTION_STRING) foram movidas para o arquivo .env e lidas via process.env, mantendo as credenciais fora do c√≥digo-fonte e do reposit√≥rio Git.

4. Defesa Contra CSRF (Tokens Anti-CSRF)

O middleware csurf foi implementado para proteger todas as requisi√ß√µes POST de falsifica√ß√µes:

Configura√ß√£o: O middleware csurf() foi ativado ap√≥s o express-session no app.js.

Inje√ß√£o do Token: Um middleware global (app.use((req, res, next) => { res.locals.csrfToken = req.csrfToken(); next(); });) injeta o token secreto na vari√°vel res.locals.csrfToken, tornando-o acess√≠vel em todas as views.

Uso na View: Todos os formul√°rios POST exigem o campo oculto:

<input type="hidden" name="_csrf" value="<%= csrfToken %>">


Isso garante que apenas formul√°rios gerados pelo nosso servidor ser√£o aceitos, bloqueando tentativas de ataque externas.

üõ†Ô∏è Instru√ß√µes de Execu√ß√£o

Instala√ß√£o: npm install helmet csurf express-rate-limit dotenv express-session mongoose bcrypt

Configura√ß√£o: Crie e preencha o arquivo .env na raiz do projeto.

Execu√ß√£o: node app.js

Testes: As defesas podem ser testadas conforme o guia, verificando o bloqueio 403 (CSRF) e 429 (Rate Limit).